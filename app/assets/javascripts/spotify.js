
var playlist
var selectedPlaylist
var playlistSelected = false
var competitionSelected = false

function request(method, url, data){
  return $.ajax({
    method: method,
    url: url,
    dataType: "json",
    data: data
  })
}


function toggleVote(){
  // event.preventDefault();
  console.log("vote")
  $this = $(this)
  $playlist = $this.closest(".playlist_in_comp")
  playlist_id = parseInt($playlist_id = $playlist.find("#vote_playlist_id").val())
  request("POST", "/votes", {vote:{playlist_id: playlist_id}
  }).success(function(){
    $this.toggleClass("have_already_voted").toggleClass("have_not_already_voted")
  })
  // .success(function(){
  //   updateLikes($this, $post)
  // }).success(function(){
  //   UpdateScoreForLike($this, $post, $feed)
  // })
}


function showCompetitionSelector(){
  console.log('showCompetitionSelector')
  $('.add-playlist-title').hide();
  $('.playlist-select').hide();
  $('.competition-select').show();
}


function showPlaylistSelector() {
  console.log('showPlaylistSelector');
  $('.add-playlist-title').hide();
  $('.competition-select').hide();
  $('.playlist-select').show();
}

function newCompCreated (e) {
  console.log('newCompCreated')
  e.preventDefault();
  $('.comp-form-container').hide();
  $('.comp-friends-invite').show();
  // Need to update database here too and need to update the list of competitions if not being generated by a javascript request
}

function addPlaylistToComp (){
// Need to update DB
}


function showCompDetails (){
  $this = $(this)
  var data = $this.data('competition')
  console.log($this);
  console.log(data['name'])
}



function showPlaylistViewer () {
  console.log($(this))
  playlist = jQuery.parseJSON($(this)[0].dataset.playlist)
  var playlistUrl = playlist.url;
  var playlistId = playlist.id
  var playlistOwner = playlist.owner.id
  var iframe = $('iframe');
  // debugger
  var playlistSrc="https://embed.spotify.com/?uri=spotify:user:" + playlistOwner + ":playlist:" + playlistId
  console.log(playlistSrc)
  iframe.attr("src", playlistSrc);


}

function selectPlaylist () {
  selectedPlaylist = playlist
}


$(document).ready(function(){

  $('.playlist-select').hide();
  $('.competition-select').hide();
  $('.comp-friends-invite').hide();
  // $(".main").onepage_scroll({
  //   sectionContainer: "section",
  //   loop: true,
  //   responsiveFallback: false
  // });
});


$(function(){
  $('.submit_vote_button').on('click', toggleVote);
  $('.competition-form').on('submit', newCompCreated);
  $('.select-competition-button').on('click', showCompetitionSelector);
  $('.select-playlist-button').on('click', showPlaylistSelector);
  $('.competition-in-list').on('click', showCompDetails);
  $('.playlist-in-list').on('click', showPlaylistViewer);
  $('.playlist-seleector-button').on('click', selectPlaylist);
})





