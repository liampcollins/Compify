<!-- Left column with  list of playlists
Click on playlist brings up playlist with vote button next to it -->

<div class="competition_show">
  <p id="notice"><%= notice %></p>

<!-- Move to helper -->
  <% competition_participants = []%>
  <% @competition.playlists.each do |playlist| %>
    <% competition_participants.push(playlist.user_id)%>
  <% end %>
  <div class='competition-info-bar'>
    <div class="competition-name">
      <b>Name:</b>
      <%= @competition.name %>
    </div>
    <div class="competition-submission-close">
      <b>Submission end date:</b>
      <!-- TIMER IF POSSIBLE -->
      <%= @competition.submission_end_date %>
    </div>
    <div class="competition-vote-close">
      <b>Vote end date:
        <!-- TIMER IF POSSIBLE -->
      <%= @competition.vote_end_date %>
    </div>
  </div>


  <div class="playlist-voter">
    <div class="voter-playlist-list">
      <% @competition.playlists.each do |playlist| %>
      <div class="voter-playlist-instance">
        <div class="voter-playlist-owner">
          <%= playlist.user_id%></div>
        <div class="voter-playlist-name"><%= playlist.name%></div>
      </div>
    </div>
    <div class="playlist-player">

    </div>
  </div>





  <% @competition.playlists.each do |playlist| %>
    <div class="playlist_in_comp">
      <%= form_for(@vote) do |f| %>
        <% if @vote.errors.any? %>
          <div id="error_explanation">
            <h2><%= pluralize(@vote.errors.count, "error") %> prohibited this post from being saved:</h2>
            <ul>
            <% @vote.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
            </ul>
          </div>
        <% end %>
        <%= link_to playlist["name"], playlist_path %><br>
        <%= (User.find(playlist.user_id)).email %><br>
        <div class="post_in_comp_id"><%= f.hidden_field :playlist_id, :value => "#{playlist["id"]}"%></div>
        <%= f.hidden_field :competition_id, :value => "#{@competition.id}"%>
  <!-- CALCULATING WHAT CLASS THE BUTTON HAS AND WHAT TEXT IT HAS WHEN PAGE IS RENDERED -->
      <% playlist_voter_ids = []%>
      <% playlist.votes.each do |playlist|%>
        <% playlist_voter_ids.push(playlist.user_id)%>
      <% end %>
      <% if playlist_voter_ids.include?(current_user.id)%>
        <% button_starting_class = "have_already_voted"%>
        <% button_starting_text = "Your selected playlist"%>
      <% else %>
        <% button_starting_class = "have_not_already_voted" %>
        <% button_starting_text = "Vote for this playlist"%>
      <% end %>

  <!-- ONLY SHOW VOTE BUTTON IF ITS NOT YOUR PLAYLIST AND YOU HAVE A PLAYLIST IN THE COMPETITION -->
      <% if competition_participants.include?(current_user.id)%>
        <% if playlist.user_id != current_user.id%>
          <div class="submit_vote_button <%= button_starting_class %>" ><%= f.submit button_starting_text%></div>
        <% end %>
      <% end %>
    <% end %>
      <iframe src="https://embed.spotify.com/?uri=spotify:user:<%=playlist.user.uid%>:playlist:<%=playlist.spotify_id %>" width="250" height="80" frameborder="0" allowtransparency="true"></iframe>
    </div>
  <% end %>
  </div>
<%= link_to 'Back', competitions_path %>
</div>
